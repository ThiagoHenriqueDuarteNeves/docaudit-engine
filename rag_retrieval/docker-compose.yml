version: "3.8"

services:
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant-rag
    ports:
      - "6333:6333" # REST API
      - "6334:6334" # gRPC
    volumes:
      - ./qdrant_data:/qdrant/storage
    environment:
      - QDRANT__SERVICE__GRPC_PORT=6334
    restart: unless-stopped

  # Optional: Run the retrieval API
  retrieval-api:
    build: .
    container_name: rag-retrieval-api
    ports:
      - "8001:8001"
    environment:
      - QDRANT_URL=http://qdrant:6333
      - LMSTUDIO_BASE_URL=http://host.docker.internal:1234/v1
    depends_on:
      - qdrant
    profiles:
      - api # Only start with: docker-compose --profile api up
